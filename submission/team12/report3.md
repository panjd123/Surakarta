# 第三阶段报告
***
## Part 1 
*报告人*  仇嘉惟
***
 第三阶段：
#### 本阶段我主要负责游戏逻辑
在本阶段，我实现了：
* (1)前置窗口（pre window）、主窗口、结算窗口(post window)的分置。现在不再是一打开程序直接一个棋盘开始游戏。打开游戏后，可以在前置窗口选择游戏模式（普通的PVP、PVE、EVE、可以自由开关AI代理的FREE模式、用于重现记录的REAPPEAR模式）（不过本地的联机ONLINE模式暂未实现）。
* (2)游戏时间控制操作（ONLINE模式不适用）的进一步完善。在显示倒计时的信息栏下，有暂停和继续时间的按钮，当是人在下棋的时候，若你有什么事需要暂时离开，你可以通过暂停时间来防止TIME_OUT，不过这个时候点击棋盘则会立刻继续时间；如果是AI正在下，暂停时间可以让AI停止，这时唯有继续时间方可继续对局。这两个按钮在所有模式下均被调试为正常功能。
同时，在时间按钮下还有一个游戏开始按钮，点击此按钮游戏才能开始。
* (3)PVP、PVE、EVE模式的实现。在任何AI回合时，玩家无法触碰棋盘。
* (4)FREE模式的实现。在本地游戏的此模式下，双方AI托管可开关，且中途可随时改变。在经过了各种各样的测试和完善后，AI托管已经能够在各种各样奇怪的情况下改变但不出问题（比如在“AI思考的时候”突然关掉AI）。且(2)中所述的时间控制功能在此模式下的各种情况中仍能正常运行。在开始游戏按钮下增设了四个按钮以控制AI托管的开关。值得注意的是，无论时间是否流动，游戏是否开始，你都可以通过这四个按钮管理AI开关。通过这四个按钮可以等价地实现PVP、PVE、EVE模式。
* (5)REAPPEAR模式的辅助完善。在朱文彬同学独立完成了写入和读取相关的代码后，我们合作将它们嵌入了已有代码。为进一步实现对玩家友好的目标，我添加了在前置窗口输入文件名以复刻对应对局的功能和勾选确定是否要记录接下来对局的功能。若确定要记录接下来的对局，结算界面会新增一行通知告诉玩家对应记录的文件名。朱文彬同学为每次本地记录设计了一个随机数生成器以保证每次记录都有自己的特殊编号。
* (6)“离开对局”按钮的优化。选择点击此按钮不会是直接关闭游戏，而是回到前置窗口。
* (7)游戏素材的更新以及页面美术设计。现在棋子换成了图片素材，各个窗口均设计了其背景图片以及背景音乐。其中背景音乐做到了切换窗口时音乐也切换。按钮、信息框的布局也进一步地优化了（虽然还是很丑）。
#### 接下来是我实现的要求的游戏逻辑部分
* (1)移动提示，即以某种方式提示玩家所选的棋子可以移动到哪些位置。现在在人的下棋回合时，点击选中一个棋子后，棋盘上会出现“火焰标记”以告知玩家可以移动的位置
* (2)显示倒计时，步数等你认为有意义的对局信息。信息框中已经含有。注意倒计时的显示是有一个timer每隔50毫秒刷新一次。
* (3)对局结束后显示结算信息。post window已实现，通过在对局结束时将game info传给post window以做到。
* (4)实现高亮对手或自己最近一步下在哪。有一个变量存储上一步move，在落子后以“闪光标记”显示。
* (5)实现 8，10 路棋盘。现在就算是500路棋盘也能在窗口内显示，就是路数太大时人类下不了，AI跑不动。8、10路都还能玩。


## Part 2 
*报告人*  朱文彬
***
#### 游戏逻辑部分，实现了保存行棋记录到本地的功能，并且可以用这段编码复现对局。
* 联机逻辑部分中，主要负责客户端的实现，重点无非是对各种op的处理方式，ready_op：从命令行读参数。move_op：读取与发送都进行game、board层面的同步就行了。reject_op：暂时的功能是，被拒绝就换颜色。end_op：收到后进行结算，然后用exit(0)关闭程序，一开始没有用这个函数，导致在命令行窗口运行程序都无法结束，只好用taskkill去终止程序。
* 实现了客户端和服务端的行棋记录和网络日志功能，并且遵循文件树规范。
* 实现了服务器与之前写的游戏规则对接。进行客户端、服务端两个端的对接测试，实现一个写入文件的操作，并且遵循文件树规范。
* 写了一点界面，比如输入用户名、颜色、房间号的set键，还有返回结算信息的编辑框。

#### 遇到的困难:
* 最初客户端接受move_op后，做出的反应不对，导致游戏紊乱。怀疑是反复调用了一个moveop2move函数，导致current_player错位。


## Part 3
*报告人*  王韵雅
***
* 联机逻辑部分中，主要负责服务端的实现，实现通过简易的服务端进行通信，接受客户端的连接。服务端程序启动后立即监听端口，接受客户端的开局READY_OP信息，并判断是否合法，若游戏双方客户端的READY_OP都合法则通知客户端开局，若不合法则向不合法的客户端发送拒绝REJECT_OP信息。游戏期间接收客户端的认输RESIGN_OP信息。
* 服务端设置行棋合法性判断，胜负判断，超时判断的功能，来决定棋局的胜负使用END_OP通知客户端游戏结果。